var geeo=function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.i=function(value){return value};__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter})}};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=2)}([function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.GeeoHTTP=exports.AirBeacon=exports.POI=exports.Agent=exports.View=exports.GeeoWS=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.debounce=debounce;var _wolfy87Eventemitter=__webpack_require__(1);var _wolfy87Eventemitter2=_interopRequireDefault(_wolfy87Eventemitter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function debounce(fn,delay){var timer=null;return function(){var context=this,args=arguments;clearTimeout(timer);timer=setTimeout(function(){fn.apply(context,args)},delay)}}var GeeoWS=exports.GeeoWS=function(_EventEmitter){_inherits(GeeoWS,_EventEmitter);function GeeoWS(wsURL){_classCallCheck(this,GeeoWS);var _this=_possibleConstructorReturn(this,(GeeoWS.__proto__||Object.getPrototypeOf(GeeoWS)).call(this));_this.wsURL=wsURL;_this.ws=null;_this.position=null;_this.view=new View(_this);return _this}_createClass(GeeoWS,[{key:"connect",value:function connect(token){this.ws=new WebSocket(this.wsURL+"?token="+token);this.ws.onopen=function(){this.emit("connect")}.bind(this);this.ws.onerror=function(err){this.emit("error",err)}.bind(this);this.ws.onmessage=function(message){var arr=JSON.parse(message.data);if(arr.error){return this.emit("error",arr)}this.view._receiveMessage(arr);this.emit("viewUpdated")}.bind(this);this.ws.onclose=function(err){this.emit("close",err)}.bind(this)}},{key:"move",value:function move(lon,lat){this.position=[lon,lat];this.ws.send(JSON.stringify({agentPosition:this.position}))}},{key:"getPosition",value:function getPosition(){return this.position}},{key:"addPOI",value:function addPOI(poi){this.ws.send(JSON.stringify({createPOI:poi}))}},{key:"removePOI",value:function removePOI(poi){this.ws.send(JSON.stringify({removePOI:poi}))}},{key:"addAirBeacon",value:function addAirBeacon(ab){this.ws.send(JSON.stringify({createAirBeacon:ab}))}},{key:"removeAirBeacon",value:function removeAirBeacon(ab){this.ws.send(JSON.stringify({removeAirBeacon:ab}))}},{key:"close",value:function close(){this.ws.close()}}]);return GeeoWS}(_wolfy87Eventemitter2.default);var View=exports.View=function(_EventEmitter2){_inherits(View,_EventEmitter2);function View(parent){_classCallCheck(this,View);var _this2=_possibleConstructorReturn(this,(View.__proto__||Object.getPrototypeOf(View)).call(this));_this2.parent=parent;_this2.position=null;_this2.pois={};_this2.agents={};return _this2}_createClass(View,[{key:"move",value:function move(lon1,lat1,lon2,lat2){this.position=[lon1,lat1,lon2,lat2];this.parent.ws.send(JSON.stringify({viewPosition:this.position}))}},{key:"getPosition",value:function getPosition(){return this.position}},{key:"pois",value:function pois(){var result=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.pois[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _step$value=_slicedToArray(_step.value,2),k=_step$value[0],v=_step$value[1];result.push(v)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return result}},{key:"agents",value:function agents(){var result=[];var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.agents[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _step2$value=_slicedToArray(_step2.value,2),k=_step2$value[0],v=_step2$value[1];result.push(v)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return result}},{key:"_receiveMessage",value:function _receiveMessage(message){var _this3=this;message.forEach(function(update){if(update.agent_id){if(update.entered){var agent=new Agent(update.agent_id,update.pos,update.publicData);_this3.agents[agent.id]=agent;_this3.emit("agentEntered",agent)}else if(update.left){var _agent=_this3.agents[update.agent_id];_this3.emit("agentLeft",_agent);delete(_this3.agents,_agent.id)}else{var _agent2=_this3.agents[update.agent_id];if(!_agent2){console.log(update);return}_agent2.pos=update.pos;_this3.emit("agentMoved",_agent2)}}else if(update.poi_id){if(update.entered&&update.pos!=undefined){var poi=new POI(update.poi_id,update.pos,update.publicData,update.creator);_this3.pois[poi.id]=poi;_this3.emit("poiEntered",poi)}if(update.left){var _poi=_this3.pois[update.poi_id];_this3.emit("poiLeft",_poi);delete(_this3.pois,_poi.id)}}})}}]);return View}(_wolfy87Eventemitter2.default);var Agent=exports.Agent=function Agent(id,pos,publicData){_classCallCheck(this,Agent);this.id=id;this.pos=pos;this.publicData=publicData};var POI=exports.POI=function POI(id,pos,publicData,creator){_classCallCheck(this,POI);this.id=id;this.pos=pos;this.publicData=publicData;this.creator=creator};var AirBeacon=exports.AirBeacon=function AirBeacon(id,pos,publicData,creator){_classCallCheck(this,AirBeacon);this.id=id;this.pos=pos;this.publicData=publicData;this.creator=creator};var GeeoHTTP=exports.GeeoHTTP=function(){function GeeoHTTP(httpURL){_classCallCheck(this,GeeoHTTP);this.httpURL=httpURL}_createClass(GeeoHTTP,[{key:"getGuestToken",value:function getGuestToken(agentId,viewPortId){return fetch(this.httpURL+"/api/dev/token?viewId="+viewPortId+"&agId="+agentId).then(function(response){if(response.ok){return response.text()}else{throw new Error("Can't get JWT Token (status="+response.status+")")}})}}]);return GeeoHTTP}()},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;(function(exports){"use strict";function EventEmitter(){}var proto=EventEmitter.prototype;var originalGlobalValue=exports.EventEmitter;function indexOfListener(listeners,listener){var i=listeners.length;while(i--){if(listeners[i].listener===listener){return i}}return-1}function alias(name){return function aliasClosure(){return this[name].apply(this,arguments)}}proto.getListeners=function getListeners(evt){var events=this._getEvents();var response;var key;if(evt instanceof RegExp){response={};for(key in events){if(events.hasOwnProperty(key)&&evt.test(key)){response[key]=events[key]}}}else{response=events[evt]||(events[evt]=[])}return response};proto.flattenListeners=function flattenListeners(listeners){var flatListeners=[];var i;for(i=0;i<listeners.length;i+=1){flatListeners.push(listeners[i].listener)}return flatListeners};proto.getListenersAsObject=function getListenersAsObject(evt){var listeners=this.getListeners(evt);var response;if(listeners instanceof Array){response={};response[evt]=listeners}return response||listeners};function isValidListener(listener){if(typeof listener==="function"||listener instanceof RegExp){return true}else if(listener&&typeof listener==="object"){return isValidListener(listener.listener)}else{return false}}proto.addListener=function addListener(evt,listener){if(!isValidListener(listener)){throw new TypeError("listener must be a function")}var listeners=this.getListenersAsObject(evt);var listenerIsWrapped=typeof listener==="object";var key;for(key in listeners){if(listeners.hasOwnProperty(key)&&indexOfListener(listeners[key],listener)===-1){listeners[key].push(listenerIsWrapped?listener:{listener:listener,once:false})}}return this};proto.on=alias("addListener");proto.addOnceListener=function addOnceListener(evt,listener){return this.addListener(evt,{listener:listener,once:true})};proto.once=alias("addOnceListener");proto.defineEvent=function defineEvent(evt){this.getListeners(evt);return this};proto.defineEvents=function defineEvents(evts){for(var i=0;i<evts.length;i+=1){this.defineEvent(evts[i])}return this};proto.removeListener=function removeListener(evt,listener){var listeners=this.getListenersAsObject(evt);var index;var key;for(key in listeners){if(listeners.hasOwnProperty(key)){index=indexOfListener(listeners[key],listener);if(index!==-1){listeners[key].splice(index,1)}}}return this};proto.off=alias("removeListener");proto.addListeners=function addListeners(evt,listeners){return this.manipulateListeners(false,evt,listeners)};proto.removeListeners=function removeListeners(evt,listeners){return this.manipulateListeners(true,evt,listeners)};proto.manipulateListeners=function manipulateListeners(remove,evt,listeners){var i;var value;var single=remove?this.removeListener:this.addListener;var multiple=remove?this.removeListeners:this.addListeners;if(typeof evt==="object"&&!(evt instanceof RegExp)){for(i in evt){if(evt.hasOwnProperty(i)&&(value=evt[i])){if(typeof value==="function"){single.call(this,i,value)}else{multiple.call(this,i,value)}}}}else{i=listeners.length;while(i--){single.call(this,evt,listeners[i])}}return this};proto.removeEvent=function removeEvent(evt){var type=typeof evt;var events=this._getEvents();var key;if(type==="string"){delete events[evt]}else if(evt instanceof RegExp){for(key in events){if(events.hasOwnProperty(key)&&evt.test(key)){delete events[key]}}}else{delete this._events}return this};proto.removeAllListeners=alias("removeEvent");proto.emitEvent=function emitEvent(evt,args){var listenersMap=this.getListenersAsObject(evt);var listeners;var listener;var i;var key;var response;for(key in listenersMap){if(listenersMap.hasOwnProperty(key)){listeners=listenersMap[key].slice(0);for(i=0;i<listeners.length;i++){listener=listeners[i];if(listener.once===true){this.removeListener(evt,listener.listener)}response=listener.listener.apply(this,args||[]);if(response===this._getOnceReturnValue()){this.removeListener(evt,listener.listener)}}}}return this};proto.trigger=alias("emitEvent");proto.emit=function emit(evt){var args=Array.prototype.slice.call(arguments,1);return this.emitEvent(evt,args)};proto.setOnceReturnValue=function setOnceReturnValue(value){this._onceReturnValue=value;return this};proto._getOnceReturnValue=function _getOnceReturnValue(){if(this.hasOwnProperty("_onceReturnValue")){return this._onceReturnValue}else{return true}};proto._getEvents=function _getEvents(){return this._events||(this._events={})};EventEmitter.noConflict=function noConflict(){exports.EventEmitter=originalGlobalValue;return EventEmitter};if(true){!(__WEBPACK_AMD_DEFINE_RESULT__=function(){return EventEmitter}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else if(typeof module==="object"&&module.exports){module.exports=EventEmitter}else{exports.EventEmitter=EventEmitter}})(this||{})},function(module,exports,__webpack_require__){__webpack_require__(0);module.exports=__webpack_require__(0)}]);